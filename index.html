<!DOCTYPE html>
<html lang="en" manifest="site.manifest">

  <head>
    <meta charset="utf-8">
    <title>PassWord Wallet</title>
    <meta name="description" content="">
    <meta name="author" content="Mathieu Dutour">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#14EBFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="./manifest.json">
	  <link rel="stylesheet" href="./assets/css/uikit.almost-flat.css">
    <link rel="shortcut icon" href="./assets/ios/favicon.ico">
    <link rel="apple-touch-icon" href="./assets/images/icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="./assets/images/icon-72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="vassets/images/icon@2x.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="vassets/images/icon-72@2x.png" />
    <link href="./assets/ios/startup-320x460.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">
    <link href="./assets/ios/startup.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
  </head>
  <body>
    <nav class="uk-navbar" role="navigation">
      <a class="uk-navbar-brand" href="#">PassWord Wallet</a>
    </nav>
    <div class="uk-width-9-10 uk-container-center">
      <br />
      <div id="message"></div>
      <div id="connexion">
        <form name="Form" id="Form" class="uk-form">
          <fieldset>
            <legend id ="title">Connexion</legend>
            <div class="uk-form-row">
              <div class="uk-form-password uk-width-1-1">
                <input class="uk-form-large uk-width-1-1" id="pass" name="pass" type="password" placeholder="Password" autofocus="autofocus"/>
                <a href="" class="uk-form-password-toggle" id="toggle-show-password">Show</a>
              </div>
              <input id="passhide" name="passhide" type="hidden" value="false"/>
            </div>
            <div class="uk-form-row">
              <input type="submit" id="submit" name="submit" value="Connexion" class="uk-button" />
            </div>
          </fieldset>
        </form>
      </div>
    </div>
    <script src="assets/js/password.js"></script>
      <script type="text/javascript">
      function selectAndCopyText(element) {
        var text = document.getElementById(element);

        // copy text
        const el = document.createElement('textarea');
        el.value = text.innerText;
        el.setAttribute('readonly', '');
        el.style.position = 'absolute';
        el.style.left = '-9999px';
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        // select it as well
        var selection = document.getSelection();
        var range = document.createRange();
        range.selectNodeContents(text);
        selection.removeAllRanges();
        selection.addRange(range);
      }

        document.addEventListener('DOMContentLoaded', function() {
          // add event listener for password visibility toggle
          var toggle = document.getElementById('toggle-show-password')
          var input = document.getElementById('pass')

          toggle.addEventListener('click', function(e) {
            e.preventDefault()
            input.type = input.type === 'text' ? 'password' : 'text'
            toggle.innerText = input.type === 'text' ? 'Hide' : 'Show'
          })

          // add event listener for form submit event
          var alert = document.getElementById("message")
          document.getElementById('Form').addEventListener('submit', function(e) {
            e.preventDefault();
            var password = input.value
            var salt = document.getElementById("passhide").value

            if(password && password.length !== 0 && (!salt || salt === "false")) {
              alert.innerHTML = "<div class='uk-alert'><button type='button' class='uk-alert-close uk-close' aria-hidden=\"true\">&times;</button><strong>Success !</strong> You are now connected.</div>";
              document.getElementById("passhide").setAttribute("value",password);
              input.setAttribute("placeholder","Website's ID");
              input.value = '';
              document.getElementById("submit").setAttribute("value","Get the password");
              document.getElementById("title").innerHTML = "Get the password";
            } else if(password && password.length !== 0 && salt && salt !== "false") {
              alert.innerHTML = "<div class='uk-alert' id='password-result'></div>"
              document.getElementById('password-result').innerText = generatePassword(password, salt)
              selectAndCopyText("password-result")
            } else {
              alert.innerHTML = "<div class='uk-alert uk-alert-danger'><button type=\"button\" class='uk-alert-close uk-close' aria-hidden=\"true\">&times;</button><strong>Something went wrong !</strong> Please try again.</div>"
            }
        })
      })


      // load service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js').then(function(registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function(err) {
            // registration failed :(
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>
